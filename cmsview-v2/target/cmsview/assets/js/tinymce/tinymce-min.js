angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(a,e,d,g,c,b,f){b=b||{};if(b.baseUrl){tinymce.baseURL=b.baseUrl}return{require:["ngModel","^?form"],priority:599,link:function(t,n,r,l){if(!g.tinymce){return}var m=l[0],h=l[1]||null;var q,v={debounce:true},k,u=function(w){var x=w.getContent({format:v.format}).trim();x=c.trustAsHtml(x);m.$setViewValue(x);if(!a.$$phase){t.$digest()}};function o(w){if(w){s();if(k){k.getBody().setAttribute("contenteditable",false)}}else{s();if(k&&!k.settings.readonly&&k.getDoc()){k.getBody().setAttribute("contenteditable",true)}}}var p=f.getUniqueId();r.$set("id",p);q={};angular.extend(q,t.$eval(r.uiTinymce));var j=(function(x){var w;return function(y){d.cancel(w);w=d(function(){return(function(z){if(z.isDirty()){z.save();u(z)}})(y)},x)}})(400);var i={setup:function(w){w.on("init",function(){m.$render();m.$setPristine();m.$setUntouched();if(h){h.$setPristine()}});w.on("ExecCommand change NodeChange ObjectResized",function(){if(!v.debounce){w.save();u(w);return}j(w)});w.on("blur",function(){n[0].blur();m.$setTouched();if(!a.$$phase){t.$digest()}});w.on("remove",function(){n.remove()});if(b.setup){b.setup(w,{updateView:u})}if(q.setup){q.setup(w,{updateView:u})}},format:q.format||"html",selector:"#"+r.id};angular.extend(v,b,q,i);d(function(){if(v.baseURL){tinymce.baseURL=v.baseURL}var w=tinymce.init(v);if(w&&typeof w.then==="function"){w.then(function(){o(t.$eval(r.ngDisabled))})}else{o(t.$eval(r.ngDisabled))}});m.$formatters.unshift(function(w){return w?c.trustAsHtml(w):""});m.$parsers.unshift(function(w){return w?c.getTrustedHtml(w):""});m.$render=function(){s();var w=m.$viewValue?c.getTrustedHtml(m.$viewValue):"";if(k&&k.getDoc()){k.setContent(w);k.fire("change")}};r.$observe("disabled",o);t.$on("$tinymce:refresh",function(z,A){var y=r.id;if(angular.isUndefined(A)||A===y){var w=n.parent();var x=n.clone();x.removeAttr("id");x.removeAttr("style");x.removeAttr("aria-hidden");tinymce.execCommand("mceRemoveEditor",false,y);w.append(e(x)(t))}});t.$on("$destroy",function(){s();if(k){k.remove();k=null}});function s(){if(!k){k=tinymce.get(r.id)}}}}}]).service("uiTinymceService",[function(){var a=function(){var b="ui-tinymce";var d=0;var c=function(){d++;return b+"-"+d};return{getUniqueId:c}};return new a()}]);