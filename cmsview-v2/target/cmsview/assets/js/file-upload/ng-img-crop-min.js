/*!
 * ngImgCrop v0.3.2
 * https://github.com/alexk111/ngImgCrop
 *
 * Copyright (c) 2014 Alex Kaul
 * License: MIT
 *
 * Generated at Wednesday, December 3rd, 2014, 3:54:12 PM
 */
(function(){var a=angular.module("ngImgCrop",[]);a.factory("cropAreaCircle",["cropArea",function(c){var b=function(){c.apply(this,arguments);this._boxResizeBaseSize=20;this._boxResizeNormalRatio=0.9;this._boxResizeHoverRatio=1.2;this._iconMoveNormalRatio=0.9;this._iconMoveHoverRatio=1.2;this._boxResizeNormalSize=this._boxResizeBaseSize*this._boxResizeNormalRatio;this._boxResizeHoverSize=this._boxResizeBaseSize*this._boxResizeHoverRatio;this._posDragStartX=0;this._posDragStartY=0;this._posResizeStartX=0;this._posResizeStartY=0;this._posResizeStartSize=0;this._boxResizeIsHover=false;this._areaIsHover=false;this._boxResizeIsDragging=false;this._areaIsDragging=false};b.prototype=new c();b.prototype._calcCirclePerimeterCoords=function(g){var h=this._size/2;var f=g*(Math.PI/180),e=this._x+h*Math.cos(f),d=this._y+h*Math.sin(f);return[e,d]};b.prototype._calcResizeIconCenterCoords=function(){return this._calcCirclePerimeterCoords(-45)};b.prototype._isCoordWithinArea=function(d){return Math.sqrt((d[0]-this._x)*(d[0]-this._x)+(d[1]-this._y)*(d[1]-this._y))<this._size/2};b.prototype._isCoordWithinBoxResize=function(f){var d=this._calcResizeIconCenterCoords();var e=this._boxResizeHoverSize/2;return(f[0]>d[0]-e&&f[0]<d[0]+e&&f[1]>d[1]-e&&f[1]<d[1]+e)};b.prototype._drawArea=function(d,f,e){d.arc(f[0],f[1],e/2,0,2*Math.PI)};b.prototype.draw=function(){c.prototype.draw.apply(this,arguments);this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(),this._boxResizeBaseSize,this._boxResizeIsHover?this._boxResizeHoverRatio:this._boxResizeNormalRatio)};b.prototype.processMouseMove=function(f,e){var j="default";var h=false;this._boxResizeIsHover=false;this._areaIsHover=false;if(this._areaIsDragging){this._x=f-this._posDragStartX;this._y=e-this._posDragStartY;this._areaIsHover=true;j="move";h=true;this._events.trigger("area-move")}else{if(this._boxResizeIsDragging){j="nesw-resize";var d,i,g;i=f-this._posResizeStartX;g=this._posResizeStartY-e;if(i>g){d=this._posResizeStartSize+g*2}else{d=this._posResizeStartSize+i*2}this._size=Math.max(this._minSize,d);this._boxResizeIsHover=true;h=true;this._events.trigger("area-resize")}else{if(this._isCoordWithinBoxResize([f,e])){j="nesw-resize";this._areaIsHover=false;this._boxResizeIsHover=true;h=true}else{if(this._isCoordWithinArea([f,e])){j="move";this._areaIsHover=true;h=true}}}}this._dontDragOutside();angular.element(this._ctx.canvas).css({cursor:j});return h};b.prototype.processMouseDown=function(e,d){if(this._isCoordWithinBoxResize([e,d])){this._areaIsDragging=false;this._areaIsHover=false;this._boxResizeIsDragging=true;this._boxResizeIsHover=true;this._posResizeStartX=e;this._posResizeStartY=d;this._posResizeStartSize=this._size;this._events.trigger("area-resize-start")}else{if(this._isCoordWithinArea([e,d])){this._areaIsDragging=true;this._areaIsHover=true;this._boxResizeIsDragging=false;this._boxResizeIsHover=false;this._posDragStartX=e-this._x;this._posDragStartY=d-this._y;this._events.trigger("area-move-start")}}};b.prototype.processMouseUp=function(){if(this._areaIsDragging){this._areaIsDragging=false;this._events.trigger("area-move-end")}if(this._boxResizeIsDragging){this._boxResizeIsDragging=false;this._events.trigger("area-resize-end")}this._areaIsHover=false;this._boxResizeIsHover=false;this._posDragStartX=0;this._posDragStartY=0};return b}]);a.factory("cropAreaSquare",["cropArea",function(b){var c=function(){b.apply(this,arguments);this._resizeCtrlBaseRadius=10;this._resizeCtrlNormalRatio=0.75;this._resizeCtrlHoverRatio=1;this._iconMoveNormalRatio=0.9;this._iconMoveHoverRatio=1.2;this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio;this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio;this._posDragStartX=0;this._posDragStartY=0;this._posResizeStartX=0;this._posResizeStartY=0;this._posResizeStartSize=0;this._resizeCtrlIsHover=-1;this._areaIsHover=false;this._resizeCtrlIsDragging=-1;this._areaIsDragging=false};c.prototype=new b();c.prototype._calcSquareCorners=function(){var d=this._size/2;return[[this._x-d,this._y-d],[this._x+d,this._y-d],[this._x-d,this._y+d],[this._x+d,this._y+d]]};c.prototype._calcSquareDimensions=function(){var d=this._size/2;return{left:this._x-d,top:this._y-d,right:this._x+d,bottom:this._y+d}};c.prototype._isCoordWithinArea=function(e){var d=this._calcSquareDimensions();return(e[0]>=d.left&&e[0]<=d.right&&e[1]>=d.top&&e[1]<=d.bottom)};c.prototype._isCoordWithinResizeCtrl=function(j){var e=this._calcSquareCorners();var g=-1;for(var f=0,d=e.length;f<d;f++){var h=e[f];if(j[0]>h[0]-this._resizeCtrlHoverRadius&&j[0]<h[0]+this._resizeCtrlHoverRadius&&j[1]>h[1]-this._resizeCtrlHoverRadius&&j[1]<h[1]+this._resizeCtrlHoverRadius){g=f;break}}return g};c.prototype._drawArea=function(d,g,e){var f=e/2;d.rect(g[0]-f,g[1]-f,e,e)};c.prototype.draw=function(){b.prototype.draw.apply(this,arguments);this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);var e=this._calcSquareCorners();for(var f=0,d=e.length;f<d;f++){var g=e[f];this._cropCanvas.drawIconResizeCircle(g,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===f?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}};c.prototype.processMouseMove=function(m,l){var o="default";var k=false;this._resizeCtrlIsHover=-1;this._areaIsHover=false;if(this._areaIsDragging){this._x=m-this._posDragStartX;this._y=l-this._posDragStartY;this._areaIsHover=true;o="move";k=true;this._events.trigger("area-move")}else{if(this._resizeCtrlIsDragging>-1){var d,f;switch(this._resizeCtrlIsDragging){case 0:d=-1;f=-1;o="nwse-resize";break;case 1:d=1;f=-1;o="nesw-resize";break;case 2:d=-1;f=1;o="nesw-resize";break;case 3:d=1;f=1;o="nwse-resize";break}var j=(m-this._posResizeStartX)*d;var h=(l-this._posResizeStartY)*f;var n;if(j>h){n=this._posResizeStartSize+h}else{n=this._posResizeStartSize+j}var i=this._size;this._size=Math.max(this._minSize,n);var e=(this._size-i)/2;this._x+=e*d;this._y+=e*f;this._resizeCtrlIsHover=this._resizeCtrlIsDragging;k=true;this._events.trigger("area-resize")}else{var g=this._isCoordWithinResizeCtrl([m,l]);if(g>-1){switch(g){case 0:o="nwse-resize";break;case 1:o="nesw-resize";break;case 2:o="nesw-resize";break;case 3:o="nwse-resize";break}this._areaIsHover=false;this._resizeCtrlIsHover=g;k=true}else{if(this._isCoordWithinArea([m,l])){o="move";this._areaIsHover=true;k=true}}}}this._dontDragOutside();angular.element(this._ctx.canvas).css({cursor:o});return k};c.prototype.processMouseDown=function(e,d){var f=this._isCoordWithinResizeCtrl([e,d]);if(f>-1){this._areaIsDragging=false;this._areaIsHover=false;this._resizeCtrlIsDragging=f;this._resizeCtrlIsHover=f;this._posResizeStartX=e;this._posResizeStartY=d;this._posResizeStartSize=this._size;this._events.trigger("area-resize-start")}else{if(this._isCoordWithinArea([e,d])){this._areaIsDragging=true;this._areaIsHover=true;this._resizeCtrlIsDragging=-1;this._resizeCtrlIsHover=-1;this._posDragStartX=e-this._x;this._posDragStartY=d-this._y;this._events.trigger("area-move-start")}}};c.prototype.processMouseUp=function(){if(this._areaIsDragging){this._areaIsDragging=false;this._events.trigger("area-move-end")}if(this._resizeCtrlIsDragging>-1){this._resizeCtrlIsDragging=-1;this._events.trigger("area-resize-end")}this._areaIsHover=false;this._resizeCtrlIsHover=-1;this._posDragStartX=0;this._posDragStartY=0};return c}]);a.factory("cropArea",["cropCanvas",function(b){var c=function(d,e){this._ctx=d;this._events=e;this._minSize=80;this._cropCanvas=new b(d);this._image=new Image();this._x=0;this._y=0;this._size=200};c.prototype.getImage=function(){return this._image};c.prototype.setImage=function(d){this._image=d};c.prototype.getX=function(){return this._x};c.prototype.setX=function(d){this._x=d;this._dontDragOutside()};c.prototype.getY=function(){return this._y};c.prototype.setY=function(d){this._y=d;this._dontDragOutside()};c.prototype.getSize=function(){return this._size};c.prototype.setSize=function(d){this._size=Math.max(this._minSize,d);this._dontDragOutside()};c.prototype.getMinSize=function(){return this._minSize};c.prototype.setMinSize=function(d){this._minSize=d;this._size=Math.max(this._minSize,this._size);this._dontDragOutside()};c.prototype._dontDragOutside=function(){var e=this._ctx.canvas.height,d=this._ctx.canvas.width;if(this._size>d){this._size=d}if(this._size>e){this._size=e}if(this._x<this._size/2){this._x=this._size/2}if(this._x>d-this._size/2){this._x=d-this._size/2}if(this._y<this._size/2){this._y=this._size/2}if(this._y>e-this._size/2){this._y=e-this._size/2}};c.prototype._drawArea=function(){};c.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._size,this._drawArea)};c.prototype.processMouseMove=function(){};c.prototype.processMouseDown=function(){};c.prototype.processMouseUp=function(){};return c}]);a.factory("cropCanvas",[function(){var c=[[-0.5,-2],[-3,-4.5],[-0.5,-7],[-7,-7],[-7,-0.5],[-4.5,-3],[-2,-0.5]];var i=[[0.5,-2],[3,-4.5],[0.5,-7],[7,-7],[7,-0.5],[4.5,-3],[2,-0.5]];var f=[[-0.5,2],[-3,4.5],[-0.5,7],[-7,7],[-7,0.5],[-4.5,3],[-2,0.5]];var d=[[0.5,2],[3,4.5],[0.5,7],[7,7],[7,0.5],[4.5,3],[2,0.5]];var j=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]];var g=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]];var h=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]];var e=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]];var b={areaOutline:"#fff",resizeBoxStroke:"#fff",resizeBoxFill:"#444",resizeBoxArrowFill:"#fff",resizeCircleStroke:"#fff",resizeCircleFill:"#444",moveIconFill:"#fff"};return function(l){var k=function(n,p,o){return[o*n[0]+p[0],o*n[1]+p[1]]};var m=function(o,n,u,t){l.save();l.fillStyle=n;l.beginPath();var q,s=k(o[0],u,t);l.moveTo(s[0],s[1]);for(var r in o){if(r>0){q=k(o[r],u,t);l.lineTo(q[0],q[1])}}l.lineTo(s[0],s[1]);l.fill();l.closePath();l.restore()};this.drawIconMove=function(o,n){m(j,b.moveIconFill,o,n);m(g,b.moveIconFill,o,n);m(h,b.moveIconFill,o,n);m(e,b.moveIconFill,o,n)};this.drawIconResizeCircle=function(q,n,p){var o=n*p;l.save();l.strokeStyle=b.resizeCircleStroke;l.lineWidth=2;l.fillStyle=b.resizeCircleFill;l.beginPath();l.arc(q[0],q[1],o,0,2*Math.PI);l.fill();l.stroke();l.closePath();l.restore()};this.drawIconResizeBoxBase=function(p,q,o){var n=q*o;l.save();l.strokeStyle=b.resizeBoxStroke;l.lineWidth=2;l.fillStyle=b.resizeBoxFill;l.fillRect(p[0]-n/2,p[1]-n/2,n,n);l.strokeRect(p[0]-n/2,p[1]-n/2,n,n);l.restore()};this.drawIconResizeBoxNESW=function(o,p,n){this.drawIconResizeBoxBase(o,p,n);m(i,b.resizeBoxArrowFill,o,n);m(f,b.resizeBoxArrowFill,o,n)};this.drawIconResizeBoxNWSE=function(o,p,n){this.drawIconResizeBoxBase(o,p,n);m(c,b.resizeBoxArrowFill,o,n);m(d,b.resizeBoxArrowFill,o,n)};this.drawCropArea=function(s,t,r,q){var o=s.width/l.canvas.width,n=s.height/l.canvas.height,u=t[0]-r/2,p=t[1]-r/2;l.save();l.strokeStyle=b.areaOutline;l.lineWidth=2;l.beginPath();q(l,t,r);l.stroke();l.clip();if(r>0){l.drawImage(s,u*o,p*n,r*o,r*n,u,p,r,r)}l.beginPath();q(l,t,r);l.stroke();l.clip();l.restore()}}}]);a.service("cropEXIF",[function(){var k=false;var p=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};var s=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};var j=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};var h=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function m(t,v,u){if(t.addEventListener){t.addEventListener(v,u,false)}else{if(t.attachEvent){t.attachEvent("on"+v,u)}}}function g(t){return !!(t.exifdata)}function d(w,z){z=z||w.match(/^data\:([^\;]+)\;base64,/mi)[1]||"";w=w.replace(/^data\:([^\;]+)\;base64,/gmi,"");var y=atob(w);var t=y.length;var v=new ArrayBuffer(t);var u=new Uint8Array(v);for(var x=0;x<t;x++){u[x]=y.charCodeAt(x)}return v}function q(u,v){var t=new XMLHttpRequest();t.open("GET",u,true);t.responseType="blob";t.onload=function(w){if(this.status==200||this.status===0){v(this.response)}};t.send()}function c(u,y){function w(B){var A=f(B);var z=e(B);u.exifdata=A||{};u.iptcdata=z||{};if(y){y.call(u)}}if(u.src){if(/^data\:/i.test(u.src)){var x=d(u.src);w(x)}else{if(/^blob\:/i.test(u.src)){var t=new FileReader();t.onload=function(z){w(z.target.result)};q(u.src,function(z){t.readAsArrayBuffer(z)})}else{var v=new XMLHttpRequest();v.onload=function(){if(this.status==200||this.status===0){w(v.response)}else{throw"Could not load image"}v=null};v.open("GET",u.src,true);v.responseType="arraybuffer";v.send(null)}}}else{if(window.FileReader&&(u instanceof window.Blob||u instanceof window.File)){var t=new FileReader();t.onload=function(z){if(k){console.log("Got file of length "+z.target.result.byteLength)}w(z.target.result)};t.readAsArrayBuffer(u)}}}function f(u){var x=new DataView(u);if(k){console.log("Got file of length "+u.byteLength)}if((x.getUint8(0)!=255)||(x.getUint8(1)!=216)){if(k){console.log("Not a valid JPEG")}return false}var w=2,v=u.byteLength,t;while(w<v){if(x.getUint8(w)!=255){if(k){console.log("Not a valid marker at offset "+w+", found: "+x.getUint8(w))}return false}t=x.getUint8(w+1);if(k){console.log(t)}if(t==225){if(k){console.log("Found 0xFFE1 marker")}return o(x,w+4,x.getUint16(w+2)-2)}else{w+=2+x.getUint16(w+2)}}}function e(x){var A=new DataView(x);if(k){console.log("Got file of length "+x.byteLength)}if((A.getUint8(0)!=255)||(A.getUint8(1)!=216)){if(k){console.log("Not a valid JPEG")}return false}var z=2,y=x.byteLength;var u=function(C,B){return(C.getUint8(B)===56&&C.getUint8(B+1)===66&&C.getUint8(B+2)===73&&C.getUint8(B+3)===77&&C.getUint8(B+4)===4&&C.getUint8(B+5)===4)};while(z<y){if(u(A,z)){var w=A.getUint8(z+7);if(w%2!==0){w+=1}if(w===0){w=4}var t=z+8+w;var v=A.getUint16(z+6+w);return r(x,t,v);break}z++}}var b={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function r(x,A,z){var B=new DataView(x);var y={};var u,D,t,C,v;var w=A;while(w<A+z){if(B.getUint8(w)===28&&B.getUint8(w+1)===2){C=B.getUint8(w+2);if(C in b){t=B.getInt16(w+3);v=t+5;D=b[C];u=l(B,w+5,t);if(y.hasOwnProperty(D)){if(y[D] instanceof Array){y[D].push(u)}else{y[D]=[y[D],u]}}else{y[D]=u}}}w++}return y}function n(t,z,B,y,v){var w=t.getUint16(B,!v),C={},x,A,u;for(u=0;u<w;u++){x=B+u*12+2;A=y[t.getUint16(x,!v)];if(!A&&k){console.log("Unknown tag: "+t.getUint16(x,!v))}C[A]=i(t,x,z,B,v)}return C}function i(y,C,F,G,A){var B=y.getUint16(C+2,!A),E=y.getUint32(C+4,!A),u=y.getUint32(C+8,!A)+F,z,D,x,w,t,v;switch(B){case 1:case 7:if(E==1){return y.getUint8(C+8,!A)}else{z=E>4?u:(C+8);D=[];for(w=0;w<E;w++){D[w]=y.getUint8(z+w)}return D}case 2:z=E>4?u:(C+8);return l(y,z,E-1);case 3:if(E==1){return y.getUint16(C+8,!A)}else{z=E>2?u:(C+8);D=[];for(w=0;w<E;w++){D[w]=y.getUint16(z+2*w,!A)}return D}case 4:if(E==1){return y.getUint32(C+8,!A)}else{D=[];for(w=0;w<E;w++){D[w]=y.getUint32(u+4*w,!A)}return D}case 5:if(E==1){t=y.getUint32(u,!A);v=y.getUint32(u+4,!A);x=new Number(t/v);x.numerator=t;x.denominator=v;return x}else{D=[];for(w=0;w<E;w++){t=y.getUint32(u+8*w,!A);v=y.getUint32(u+4+8*w,!A);D[w]=new Number(t/v);D[w].numerator=t;D[w].denominator=v}return D}case 9:if(E==1){return y.getInt32(C+8,!A)}else{D=[];for(w=0;w<E;w++){D[w]=y.getInt32(u+4*w,!A)}return D}case 10:if(E==1){return y.getInt32(u,!A)/y.getInt32(u+4,!A)}else{D=[];for(w=0;w<E;w++){D[w]=y.getInt32(u+8*w,!A)/y.getInt32(u+4+8*w,!A)}return D}}}function l(u,x,v){var t="";for(var w=x;w<x+v;w++){t+=String.fromCharCode(u.getUint8(w))}return t}function o(x,u){if(l(x,u,4)!="Exif"){if(k){console.log("Not valid EXIF data! "+l(x,u,4))}return false}var y,A,B,w,v,z=u+6;if(x.getUint16(z)==18761){y=false}else{if(x.getUint16(z)==19789){y=true}else{if(k){console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)")}return false}}if(x.getUint16(z+2,!y)!=42){if(k){console.log("Not valid TIFF data! (no 0x002A)")}return false}var t=x.getUint32(z+4,!y);if(t<8){if(k){console.log("Not valid TIFF data! (First offset less than 8)",x.getUint32(z+4,!y))}return false}A=n(x,z,z+t,s,y);if(A.ExifIFDPointer){w=n(x,z,z+A.ExifIFDPointer,p,y);for(B in w){switch(B){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":w[B]=h[B][w[B]];break;case"ExifVersion":case"FlashpixVersion":w[B]=String.fromCharCode(w[B][0],w[B][1],w[B][2],w[B][3]);break;case"ComponentsConfiguration":w[B]=h.Components[w[B][0]]+h.Components[w[B][1]]+h.Components[w[B][2]]+h.Components[w[B][3]];break}A[B]=w[B]}}if(A.GPSInfoIFDPointer){v=n(x,z,z+A.GPSInfoIFDPointer,j,y);for(B in v){switch(B){case"GPSVersionID":v[B]=v[B][0]+"."+v[B][1]+"."+v[B][2]+"."+v[B][3];break}A[B]=v[B]}}return A}this.getData=function(t,u){if((t instanceof Image||t instanceof HTMLImageElement)&&!t.complete){return false}if(!g(t)){c(t,u)}else{if(u){u.call(t)}}return true};this.getTag=function(u,t){if(!g(u)){return}return u.exifdata[t]};this.getAllTags=function(u){if(!g(u)){return{}}var t,w=u.exifdata,v={};for(t in w){if(w.hasOwnProperty(t)){v[t]=w[t]}}return v};this.pretty=function(u){if(!g(u)){return""}var t,w=u.exifdata,v="";for(t in w){if(w.hasOwnProperty(t)){if(typeof w[t]=="object"){if(w[t] instanceof Number){v+=t+" : "+w[t]+" ["+w[t].numerator+"/"+w[t].denominator+"]\r\n"}else{v+=t+" : ["+w[t].length+" values]\r\n"}}else{v+=t+" : "+w[t]+"\r\n"}}}return v};this.readFromBinaryFile=function(t){return f(t)}}]);a.factory("cropHost",["$document","cropAreaCircle","cropAreaSquare","cropEXIF",function(e,c,f,b){var d=function(j){var m=j.getBoundingClientRect();var n=document.body;var h=document.documentElement;var g=window.pageYOffset||h.scrollTop||n.scrollTop;var k=window.pageXOffset||h.scrollLeft||n.scrollLeft;var l=h.clientTop||n.clientTop||0;var o=h.clientLeft||n.clientLeft||0;var p=m.top+g-l;var i=m.left+k-o;return{top:Math.round(p),left:Math.round(i)}};return function(q,g,u){var w=null,k=null,o=null;var v=[100,100],m=[300,300];var j=200;var p="image/png";var s=null;function i(){w.clearRect(0,0,w.canvas.width,w.canvas.height);if(k!==null){w.drawImage(k,0,0,w.canvas.width,w.canvas.height);w.save();w.fillStyle="rgba(0, 0, 0, 0.65)";w.fillRect(0,0,w.canvas.width,w.canvas.height);w.restore();o.draw()}}var t=function(){if(k!==null){o.setImage(k);var x=[k.width,k.height],y=k.width/k.height,z=x;if(z[0]>m[0]){z[0]=m[0];z[1]=z[0]/y}else{if(z[0]<v[0]){z[0]=v[0];z[1]=z[0]/y}}if(z[1]>m[1]){z[1]=m[1];z[0]=z[1]*y}else{if(z[1]<v[1]){z[1]=v[1];z[0]=z[1]*y}}q.prop("width",z[0]).prop("height",z[1]).css({"margin-left":-z[0]/2+"px","margin-top":-z[1]/2+"px"});o.setX(w.canvas.width/2);o.setY(w.canvas.height/2);o.setSize(Math.min(200,w.canvas.width/2,w.canvas.height/2))}else{q.prop("width",0).prop("height",0).css({"margin-top":0})}i()};var l=function(x){if(angular.isDefined(x.changedTouches)){return x.changedTouches}else{return x.originalEvent.changedTouches}};var h=function(z){if(k!==null){var A=d(w.canvas),y,x;if(z.type==="touchmove"){y=l(z)[0].pageX;x=l(z)[0].pageY}else{y=z.pageX;x=z.pageY}o.processMouseMove(y-A.left,x-A.top);i()}};var r=function(z){z.preventDefault();z.stopPropagation();if(k!==null){var A=d(w.canvas),y,x;if(z.type==="touchstart"){y=l(z)[0].pageX;x=l(z)[0].pageY}else{y=z.pageX;x=z.pageY}o.processMouseDown(y-A.left,x-A.top);i()}};var n=function(z){if(k!==null){var A=d(w.canvas),y,x;if(z.type==="touchend"){y=l(z)[0].pageX;x=l(z)[0].pageY}else{y=z.pageX;x=z.pageY}o.processMouseUp(y-A.left,x-A.top);i()}};this.getResultImageDataURI=function(){var x,y;y=angular.element("<canvas></canvas>")[0];x=y.getContext("2d");y.width=j;y.height=j;if(k!==null){x.drawImage(k,(o.getX()-o.getSize()/2)*(k.width/w.canvas.width),(o.getY()-o.getSize()/2)*(k.height/w.canvas.height),o.getSize()*(k.width/w.canvas.width),o.getSize()*(k.height/w.canvas.height),0,0,j,j)}if(s!==null){return y.toDataURL(p,s)}return y.toDataURL(p)};this.setNewImageSource=function(y){k=null;t();u.trigger("image-updated");if(!!y){var x=new Image();if(y.substring(0,4).toLowerCase()==="http"){x.crossOrigin="anonymous"}x.onload=function(){u.trigger("load-done");b.getData(x,function(){var C=b.getTag(x,"Orientation");if([3,6,8].indexOf(C)>-1){var D=document.createElement("canvas"),B=D.getContext("2d"),A=x.width,E=x.height,z=0,G=0,F=0;switch(C){case 3:z=-x.width;G=-x.height;F=180;break;case 6:A=x.height;E=x.width;G=-x.height;F=90;break;case 8:A=x.height;E=x.width;z=-x.width;F=270;break}D.width=A;D.height=E;B.rotate(F*Math.PI/180);B.drawImage(x,z,G);k=new Image();k.src=D.toDataURL("image/png")}else{k=x}t();u.trigger("image-updated")})};x.onerror=function(){u.trigger("load-error")};u.trigger("load-start");x.src=y}};this.setMaxDimensions=function(y,G){m=[y,G];if(k!==null){var D=w.canvas.width,C=w.canvas.height;var B=[k.width,k.height],A=k.width/k.height,F=B;if(F[0]>m[0]){F[0]=m[0];F[1]=F[0]/A}else{if(F[0]<v[0]){F[0]=v[0];F[1]=F[0]/A}}if(F[1]>m[1]){F[1]=m[1];F[0]=F[1]*A}else{if(F[1]<v[1]){F[1]=v[1];F[0]=F[1]*A}}q.prop("width",F[0]).prop("height",F[1]).css({"margin-left":-F[0]/2+"px","margin-top":-F[1]/2+"px"});var E=w.canvas.width/D,x=w.canvas.height/C,z=Math.min(E,x);o.setX(o.getX()*E);o.setY(o.getY()*x);o.setSize(o.getSize()*z)}else{q.prop("width",0).prop("height",0).css({"margin-top":0})}i()};this.setAreaMinSize=function(x){x=parseInt(x,10);if(!isNaN(x)){o.setMinSize(x);i()}};this.setResultImageSize=function(x){x=parseInt(x,10);if(!isNaN(x)){j=x}};this.setResultImageFormat=function(x){p=x};this.setResultImageQuality=function(x){x=parseFloat(x);if(!isNaN(x)&&x>=0&&x<=1){s=x}};this.setAreaType=function(B){var z=o.getSize(),C=o.getMinSize(),y=o.getX(),x=o.getY();var A=c;if(B==="square"){A=f}o=new A(w,u);o.setMinSize(C);o.setSize(z);o.setX(y);o.setY(x);if(k!==null){o.setImage(k)}i()};w=q[0].getContext("2d");o=new c(w,u);e.on("mousemove",h);q.on("mousedown",r);e.on("mouseup",n);e.on("touchmove",h);q.on("touchstart",r);e.on("touchend",n);this.destroy=function(){e.off("mousemove",h);q.off("mousedown",r);e.off("mouseup",h);e.off("touchmove",h);q.off("touchstart",r);e.off("touchend",h);q.remove()}}}]);a.factory("cropPubSub",[function(){return function(){var b={};this.on=function(d,c){d.split(" ").forEach(function(e){if(!b[e]){b[e]=[]}b[e].push(c)});return this};this.trigger=function(d,c){angular.forEach(b[d],function(e){e.call(null,c)});return this}}}]);a.directive("imgCrop",["$timeout","cropHost","cropPubSub",function(b,c,d){return{restrict:"E",scope:{image:"=",resultImage:"=",changeOnFly:"=",areaType:"@",areaMinSize:"=",resultImageSize:"=",resultImageFormat:"@",resultImageQuality:"=",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function(e){e.events=new d()}],link:function(k,j){var i=k.events;var g=new c(j.find("canvas"),{},i);var e;var f=function(m){var l=g.getResultImageDataURI();if(e!==l){e=l;if(angular.isDefined(m.resultImage)){m.resultImage=l}m.onChange({$dataURI:m.resultImage})}};var h=function(l){return function(){b(function(){k.$apply(function(m){l(m)})})}};i.on("load-start",h(function(l){l.onLoadBegin({})})).on("load-done",h(function(l){l.onLoadDone({})})).on("load-error",h(function(l){l.onLoadError({})})).on("area-move area-resize",h(function(l){if(!!l.changeOnFly){f(l)}})).on("area-move-end area-resize-end image-updated",h(function(l){f(l)}));k.$watch("image",function(){g.setNewImageSource(k.image)});k.$watch("areaType",function(){g.setAreaType(k.areaType);f(k)});k.$watch("areaMinSize",function(){g.setAreaMinSize(k.areaMinSize);f(k)});k.$watch("resultImageSize",function(){g.setResultImageSize(k.resultImageSize);f(k)});k.$watch("resultImageFormat",function(){g.setResultImageFormat(k.resultImageFormat);f(k)});k.$watch("resultImageQuality",function(){g.setResultImageQuality(k.resultImageQuality);f(k)});k.$watch(function(){return[j[0].clientWidth,j[0].clientHeight]},function(l){g.setMaxDimensions(l[0],l[1]);f(k)},true);k.$on("$destroy",function(){g.destroy()})}}}])}());