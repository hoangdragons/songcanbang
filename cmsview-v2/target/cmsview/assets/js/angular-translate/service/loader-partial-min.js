angular.module("pascalprecht.translate").provider("$translatePartialLoader",$translatePartialLoader);function $translatePartialLoader(){function a(h,i){this.name=h;this.isActive=true;this.tables={};this.priority=i||0}a.prototype.parseUrl=function(i,h){if(angular.isFunction(i)){return i(this.name,h)}return i.replace(/\{part\}/g,this.name).replace(/\{lang\}/g,h)};a.prototype.getTable=function(m,j,n,k,l,i){if(!this.tables[m]){var h=this;return n(angular.extend({method:"GET",url:this.parseUrl(l,m)},k)).then(function(o){h.tables[m]=o.data;return o.data},function(o){if(i){return i(h.name,m,o).then(function(p){h.tables[m]=p;return p},function(){return j.reject(h.name)})}else{return j.reject(h.name)}})}else{return j.when(this.tables[m])}};var e={};function g(h){return Object.prototype.hasOwnProperty.call(e,h)}function d(h){return angular.isString(h)&&h!==""}function f(h){if(!d(h)){throw new TypeError("Invalid type of a first argument, a non-empty string expected.")}return(g(h)&&e[h].isActive)}function b(j,i){for(var h in i){if(i[h]&&i[h].constructor&&i[h].constructor===Object){j[h]=j[h]||{};b(j[h],i[h])}else{j[h]=i[h]}}return j}function c(){var i=[];for(var h in e){if(e[h].isActive){i.push(e[h])}}i.sort(function(k,j){return k.priority-j.priority});return i}this.addPart=function(h,i){if(!d(h)){throw new TypeError("Couldn't add part, part name has to be a string!")}if(!g(h)){e[h]=new a(h,i)}e[h].isActive=true;return this};this.setPart=function(j,h,i){if(!d(j)){throw new TypeError("Couldn't set part.`lang` parameter has to be a string!")}if(!d(h)){throw new TypeError("Couldn't set part.`part` parameter has to be a string!")}if(typeof i!=="object"||i===null){throw new TypeError("Couldn't set part. `table` parameter has to be an object!")}if(!g(h)){e[h]=new a(h);e[h].isActive=false}e[h].tables[j]=i;return this};this.deletePart=function(h){if(!d(h)){throw new TypeError("Couldn't delete part, first arg has to be string.")}if(g(h)){e[h].isActive=false}return this};this.isPartAvailable=f;this.$get=["$rootScope","$injector","$q","$http",function(i,k,j,l){var h=function(o){if(!d(o.key)){throw new TypeError("Unable to load data, a key is not a non-empty string.")}if(!d(o.urlTemplate)&&!angular.isFunction(o.urlTemplate)){throw new TypeError("Unable to load data, a urlTemplate is not a non-empty string or not a function.")}var n=o.loadFailureHandler;if(n!==undefined){if(!angular.isString(n)){throw new Error("Unable to load data, a loadFailureHandler is not a string.")}else{n=k.get(n)}}var m=[],p=c();angular.forEach(p,function(q){m.push(q.getTable(o.key,j,l,o.$http,o.urlTemplate,n));q.urlTemplate=o.urlTemplate});return j.all(m).then(function(){var q={};p=c();angular.forEach(p,function(r){b(q,r.tables[o.key])});return q},function(){return j.reject(o.key)})};h.addPart=function(m,n){if(!d(m)){throw new TypeError("Couldn't add part, first arg has to be a string")}if(!g(m)){e[m]=new a(m,n);i.$emit("$translatePartialLoaderStructureChanged",m)}else{if(!e[m].isActive){e[m].isActive=true;i.$emit("$translatePartialLoaderStructureChanged",m)}}return h};h.deletePart=function(n,q){if(!d(n)){throw new TypeError("Couldn't delete part, first arg has to be string")}if(q===undefined){q=false}else{if(typeof q!=="boolean"){throw new TypeError("Invalid type of a second argument, a boolean expected.")}}if(g(n)){var o=e[n].isActive;if(q){var p=k.get("$translate");var m=p.loaderCache();if(typeof(m)==="string"){m=k.get(m)}if(typeof(m)==="object"){angular.forEach(e[n].tables,function(s,r){m.remove(e[n].parseUrl(e[n].urlTemplate,r))})}delete e[n]}else{e[n].isActive=false}if(o){i.$emit("$translatePartialLoaderStructureChanged",n)}}return h};h.isPartLoaded=function(m,n){return angular.isDefined(e[m])&&angular.isDefined(e[m].tables[n])};h.getRegisteredParts=function(){var m=[];angular.forEach(e,function(n){if(n.isActive){m.push(n.name)}});return m};h.isPartAvailable=f;return h}]}$translatePartialLoader.displayName="$translatePartialLoader";