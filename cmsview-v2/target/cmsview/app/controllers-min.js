Array.prototype.contains=function(a){var b=this.length;while(b--){if(this[b].courseId===a.courseId){return true}}return false};var app=angular.module("dolphin.controller",["dolphin.service","dolphin.directive"]);app.controller("CommonController",function(m,a,e,k,d,h,j,g,l,f,i,b){m.categories=l.getAll.query();m.openCategory=function(n){window.location.href=d.cmsview+"/#/courses/courseList/"+n.categoryId};m.contactInfo={};m.contactSCB=function(n){f.save(n,function(o){alert("Contact songcanbang.org successfully!");m.contactInfo={}})};m.previewVideoUrl=function(n){if(typeof n!=="undefined"&&n!=""){j.get("$modal").open({template:'<div style="text-align:center;vertical-align:middle;height:auto;width:auto"><div class="modal-header"><h4 class="modal-title" id="myModalLabel">'+g("translate")("common.PREVIEW")+'</h4></div><video width="550" height="350" controls poster="http://rc.songcanbang.org/images/video.jpg" ><source src="'+n+'" type="video/mp4">Your browser doesnt support HTML5 video tag.</video><div>',})}};m.openProfile=function(){window.location=d.idm+"/#/app/profile/?token="+i.jwt};m.previewVideo=function(n){m.previewVideoUrl(n.videoUrl)};m.contextPath=d;m.setLang=function(n){a.use(n);$("#selectedLangImg").attr("src","assets/images/flags/"+n.substring(0,2)+".png")};m.convertMoney=function(n){if(typeof n!="undefined"){if(n==0){return"common.PRICE_FREE"}else{return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+"Ä‘"}}};m.searchCourse=function(n){if(typeof n!="undefined"&&n.trim()!=""){e.path("/courses/search/"+n.trim())}else{e.path("/courses/courseList/0")}};m.fowardToLoginPage=function(){var n=encodeURIComponent(e.absUrl());window.location=d.idm+"/#/app/login?service="+n};m.registerNewUser=function(){};m.logout=function(){m.$parent.signedInUser=undefined;delete i.jwt;b(function(){window.location=d.cmsview},110)};m.openInstructionPage=function(){if(typeof m.$parent.signedInUser==="undefined"||m.$parent.signedInUser==null){m.fowardToLoginPage()}window.location=d.cmsadmin+"/#/teaching/home?token="+i.jwt};m.convertHtml=function(n){return h.trustAsHtml(n)};m.trustUrl=function(n){return h.trustAsResourceUrl(n)};m.lsCategory=l.getAll.query();m.scrollToElement=function(p,n){var o=(n)?n:600;$("html,body").animate({scrollTop:$(p).offset().top},o)};m.goServices=function(){window.location.href=app.cmsViewUrl};m.convertHtml=function(n){return h.trustAsHtml(n)};m.showCourseDetail=function(n){e.path("/courses/courseDetail/"+n)};m.totalAmount=0;m.totalOriginAmount=0;m.savePercentage=0;(function(){if(typeof i.shoppingCart!=="undefined"&&i.shoppingCart!==null){i.shoppingCart.forEach(function(n){m.totalOriginAmount+=n.price;m.totalAmount+=n.discountPrice})}else{i.shoppingCart=[]}})();m.shoppingCart=i.shoppingCart;m.addToCart=function(n){if(typeof i.shoppingCart=="undefined"||i.shoppingCart==null){i.shoppingCart=new Array()}if(!i.shoppingCart.contains(n)){i.shoppingCart.push(n);m.totalOriginAmount+=n.price;m.totalAmount+=n.discountPrice;m.cartItemLength=i.shoppingCart&&i.shoppingCart.length?i.shoppingCart.length:0}m.shoppingCart=i.shoppingCart};m.removeFromCart=function(n){var o=i.shoppingCart.filter(function(p){return p.courseId!==n.courseId});if(i.shoppingCart.length>o.length){i.shoppingCart=o;m.totalOriginAmount-=c.price;m.totalAmount-=c.discountPrice;m.cartItemLength=i.shoppingCart&&i.shoppingCart.length?i.shoppingCart.length:0;m.shoppingCart=i.shoppingCart}};m.cartItemLength=i.shoppingCart&&i.shoppingCart.length?i.shoppingCart.length:0});app.controller("HomepageController",function(b,g,f,h){b.orderBy="puslishDate";b.lsCategoryAndCourse=[];b.prevButtonIsEnabled=true;b.infiniteScrollIsEnabled=true;b.nextButtonIsEnabled=true;var a=(window.innerWidth>0)?window.innerWidth:screen.width;var e=1;e=a<=500?1:a>500&&a<600?3:a>600&&a<960?4:a>960&&a<1024?5:6;b.nextPage=function(i){if(i.page*6<i.courseCount.count){i.page++;i.lsCourse=f.getListCourseWithRcp.query({page:i.page,categoryId:i.categoryId,orderBy:b.orderBy,rcp:e})}};b.previousPage=function(i){if(i.page>1){i.page--;i.lsCourse=f.getListCourseWithRcp.query({page:i.page,categoryId:i.categoryId,orderBy:b.orderBy,rcp:e})}};g.getAll.query(function(i){d(i)});var d=function(j){for(var i=0;i<j.length;i++){var k={page:1,categoryName:j[i].categoryName,categoryId:j[i].categoryId,courseCount:f.courseCount.get({categoryId:j[i].categoryId}),lsCourse:f.getListCourseWithRcp.query({page:1,categoryId:j[i].categoryId,orderBy:b.orderBy,rcp:e})};b.lsCategoryAndCourse.push(k)}}});app.controller("SearchCourseController",function(a,e,d,b){a.reloadLsCourse=function(f){a.p=f;a.lsCourse=d.searchListCourse.query({page:a.p,searchText:b.searchText,orderBy:a.orderBy});a.paging=d.getTotalPageSearchCourse.get({searchText:b.searchText})};a.orderBy="puslishDate";a.reloadLsCourse(1)});app.controller("ShoppingCartController",function(a,e,b,d,f){a.checkout=function(){f.path("/courses/coursePayment/-1")};a.couponCodeTxt="";a.applyCoupon=function(){e.get({ccode:a.couponCodeTxt},function(g){if(typeof g!=="undefined"&&g!=null){a.totalOriginAmount=0;a.totalAmount=0;b.shoppingCart.forEach(function(h){a.totalOriginAmount+=h.price;h.discountPrice=Math.ceil((100-g.discount)*h.price/100);a.totalAmount+=h.discountPrice})}})}});